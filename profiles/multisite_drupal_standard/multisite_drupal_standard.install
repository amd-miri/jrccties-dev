<?php

/**
 * Implements hook_install().
 *
 * Perform actions to set up the site for this profile.
 */

function multisite_drupal_standard_install() {
  include_once DRUPAL_ROOT . '/profiles/multisite_drupal_core/multisite_drupal_core.install';
  multisite_drupal_core_install();

  // permissions to the contributor
  $contrib_rid = get_rid('contributor');
  user_role_grant_permissions($contrib_rid, array(  
    'view all unpublished content',
	//'moderate content from needs_review to published',
	'moderate content from needs_review to draft',
	//'edit any article content',
	//'delete any article content',
  )); 
  
}


/*
 * hook_update_N
 */
function multisite_drupal_standard_update_7100() {
  // editor role
  $role = db_select('role', 'r')
    ->condition('name', 'editor', '=')
    ->fields('r')
    ->execute()
    ->fetchObject();   
  if(!$role) {
    $role = new stdClass();
    $role->name = 'editor';
    user_role_save($role); 
  }

  user_role_grant_permissions($role->rid, array(  
    'create article content',
    'delete any article content',
    'delete own article content',
    'delete revisions',
    'edit any article content',
    'edit own article content',
    'export nodes',
    'moderate content from needs_review to draft',
    'moderate content from needs_review to published',
    'moderate content from needs_review to validated',
    'moderate content from published to archived',
    'moderate content from validated to published',
    'moderate content from draft to needs_review',
    'use workbench_moderation my drafts tab',
    'use workbench_moderation needs review tab',
    'revert revisions',
    'view own unpublished content',
    'view all unpublished content',
  ));  
  
  // administrator role
  $adm_rid = get_rid('administrator'); 
  user_role_revoke_permissions($adm_rid, array(
    'administer software updates',
  ));
}
